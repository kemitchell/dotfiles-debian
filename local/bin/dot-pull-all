#!/usr/bin/zsh
for dir in $HOME/.dotfiles/*
do
  basename "$dir"
	(
		cd "$dir"
		git remote update
    ours=$(git rev-parse 'HEAD')
    remote=$(git rev-parse 'origin/master')
    if [ "$ours" = "$remote" ]; then
      echo "Up-to-date"
      exit
    else
      git merge --ff-only origin/master > /dev/null 2>&1 && exit
      echo "Couldn't fast-forward.  Attempting to rebase."
      git rebase origin/master && exit
      echo "Couldn't rebase."
      if [[ "$dir" = "$HOME/.dotfiles/spelling" ]]; then
        echo "Resetting spelling dotfiles to origin's master."
        git reset --hard origin/master
      fi
      git submodule update
    fi
	)
done
