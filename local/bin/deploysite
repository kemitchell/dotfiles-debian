#!/bin/zsh
set -e

DOMAIN="$1"
if [ -z "$1" ]; then
  echo "Usage: <domain>"
  exit 1
fi

if [ "$DOMAIN" = "waypointnda.com" ]; then
  GITHUB_SLUG="waypointnda/waypointnda.com"
elif [ "$DOMAIN" = "commonform.org" ]; then
  GITHUB_SLUG="commonform/commonform.org"
elif [ "$DOMAIN" = "blog.licensezero.com" ]; then
  GITHUB_SLUG="licensezero/blog.licensezero.com"
elif [ "$DOMAIN" = "welcome.licensezero.com" ]; then
  GITHUB_SLUG="licensezero/welcome.licensezero.com"
elif [ "$DOMAIN" = "guide.licensezero.com" ]; then
  GITHUB_SLUG="licensezero/guide.licensezero.com"
elif [ "$DOMAIN" = "readerstyle.com" ]; then
  GITHUB_SLUG="readerstyle/readerstyle.com"
elif [ "$DOMAIN" = "homelessindustrial.com" ]; then
  REMOTE="git.kemitchell.com:homelessindustrial.com"
elif [ "$DOMAIN" = "patentpotato.com" ]; then
  GITHUB_SLUG="patentpotato/patentpotato.com"
else
  GITHUB_SLUG="kemitchell/$DOMAIN"
fi

if [ -z "$REMOTE" ]; then
  REMOTE="https://github.com/$GITHUB_SLUG"
fi

tmp=$(mktemp -d)
trap "rm -rf $tmp" EXIT
git clone --quiet --depth 1 "$REMOTE" "$tmp" 2>&1
cd "$tmp"
if [ -e ./publish ]; then
  ./publish 2>&1
elif [ -e ./deploy ]; then
  ./deploy 2>&1
fi
