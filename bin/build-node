#!/bin/bash
CURRENT_NODE=`node --version`
STABLE_NODE="v`GET https://semver.io/node/stable`"

if [ $CURRENT_NODE == $STABLE_NODE ]; then
	echo "Installed node $CURRENT_NODE is up-to-date"
else
	echo "Installing node $STABLE_NODE"
	command -v git >/dev/null 2>&1 || sudo apt-get install git
	command -v python2.7 >/dev/null 2>&1 || sudo apt-get install git
	command -v make >/dev/null 2>&1 || sudo apt-get install git
	command -v gcc >/dev/null 2>&1 || sudo apt-get install git
	sudo apt-get install libssl-dev
	(
		cd /tmp &&
		git clone https://github.com/joyent/node.git node &&
		cd node &&
		git checkout v`GET https://semver.io/node/stable` &&
		./configure --prefix=$HOME/local &&
		make &&
		make install &&
		cd $HOME &&
		rm -rf /tmp/node
	)
fi
