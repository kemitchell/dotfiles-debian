#!/bin/zsh
set -e

if [[ -z "$1" ]]; then
  echo "Usage: <file>"
  exit 1
fi

if [[ ! -f "$1" ]]; then
  echo "Could not file file: $1" > /dev/stderr
  exit 1
fi

digest=$(sha256sum "$1" | cut -d ' ' -f 1)
mime=$(file --mime-type "$1" | cut -d ' '  -f 2)
aws s3api put-object \
  --bucket kemitchell-documents \
  --key "$digest" \
  --content-type "$mime" \
  --body "$1" \
  > /dev/null
echo $digest
