#!/usr/bin/zsh
CACHE="$HOME/.github-my-repos"

if [[ ! -f "$CACHE" || $* == *--refresh* ]]
then
  github-my-repos | sort > "$CACHE"
  if [ -f "$HOME/.repos" ]; then
    cat "$HOME/.repos" >> "$CACHE"
  fi
fi

slug=$(cat "$CACHE" | selecta)
base=$(basename "$slug")

echo "$slug"

hub clone "$slug" "$base"

(
  cd "$base"
  ssb=$(fgrep "$slug" "$HOME/.github-to-ssb" | cut -d ' ' -f 2)
  if [[ ! -z "$ssb" ]]; then
    git remote add ssb "$ssb"
  fi
  gh issue
  git grep "TODO"
)
